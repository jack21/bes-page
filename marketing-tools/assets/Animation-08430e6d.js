var N=Object.defineProperty;var j=(a,e,t)=>e in a?N(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var d=(a,e,t)=>(j(a,typeof e!="symbol"?e+"":e,t),t),C=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var o=(a,e,t)=>(C(a,e,"read from private field"),t?t.call(a):e.get(a)),_=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)},g=(a,e,t,s)=>(C(a,e,"write to private field"),s?s.call(a,t):e.set(a,t),t);import{a as B,r as b,w as P,o as S,c as T,b as U,m as R,T as $,t as x,s as W}from"./index-1108c3db.js";const F={class:"youtube-preview-wrapper"},G=["src"],V=B({__name:"YoutubePreview",emits:["upload"],setup(a,{emit:e}){const t=b(),s=b("/ffmpeg/1920x1080.mp4");return P(t,()=>{!t||!t.value||(s.value=URL.createObjectURL(t.value),e("upload",t.value))}),(n,i)=>{const c=$;return S(),T("div",F,[U(c,{id:"video-upload",modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=f=>t.value=f),accept:"video/*"},null,8,["modelValue"]),R("video",{src:s.value,controls:"",class:"mt-3"},null,8,G)])}}});var r;(function(a){a.LOAD="LOAD",a.EXEC="EXEC",a.WRITE_FILE="WRITE_FILE",a.READ_FILE="READ_FILE",a.DELETE_FILE="DELETE_FILE",a.RENAME="RENAME",a.CREATE_DIR="CREATE_DIR",a.LIST_DIR="LIST_DIR",a.DELETE_DIR="DELETE_DIR",a.ERROR="ERROR",a.DOWNLOAD="DOWNLOAD",a.PROGRESS="PROGRESS",a.LOG="LOG"})(r||(r={}));const X=(()=>{let a=0;return()=>a++})(),Y=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),z=new Error("called FFmpeg.terminate()");var l,h,u,w,m,I,E;class H{constructor(){_(this,l,null);_(this,h,{});_(this,u,{});_(this,w,[]);_(this,m,[]);d(this,"loaded",!1);_(this,I,()=>{o(this,l)&&(o(this,l).onmessage=({data:{id:e,type:t,data:s}})=>{switch(t){case r.LOAD:this.loaded=!0,o(this,h)[e](s);break;case r.EXEC:case r.WRITE_FILE:case r.READ_FILE:case r.DELETE_FILE:case r.RENAME:case r.CREATE_DIR:case r.LIST_DIR:case r.DELETE_DIR:o(this,h)[e](s);break;case r.LOG:o(this,w).forEach(n=>n(s));break;case r.PROGRESS:o(this,m).forEach(n=>n(s));break;case r.ERROR:o(this,u)[e](s);break}delete o(this,h)[e],delete o(this,u)[e]})});_(this,E,({type:e,data:t},s=[])=>o(this,l)?new Promise((n,i)=>{const c=X();o(this,l)&&o(this,l).postMessage({id:c,type:e,data:t},s),o(this,h)[c]=n,o(this,u)[c]=i}):Promise.reject(Y));d(this,"load",(e={})=>(o(this,l)||(g(this,l,new Worker(new URL(""+new URL("worker-897e4537.js",import.meta.url).href,self.location),{type:"module"})),o(this,I).call(this)),o(this,E).call(this,{type:r.LOAD,data:e})));d(this,"exec",(e,t=-1)=>o(this,E).call(this,{type:r.EXEC,data:{args:e,timeout:t}}));d(this,"terminate",()=>{const e=Object.keys(o(this,u));for(const t of e)o(this,u)[t](z),delete o(this,u)[t],delete o(this,h)[t];o(this,l)&&(o(this,l).terminate(),g(this,l,null),this.loaded=!1)});d(this,"writeFile",(e,t)=>{const s=[];return t instanceof Uint8Array&&s.push(t.buffer),o(this,E).call(this,{type:r.WRITE_FILE,data:{path:e,data:t}},s)});d(this,"readFile",(e,t="binary")=>o(this,E).call(this,{type:r.READ_FILE,data:{path:e,encoding:t}}));d(this,"deleteFile",e=>o(this,E).call(this,{type:r.DELETE_FILE,data:{path:e}}));d(this,"rename",(e,t)=>o(this,E).call(this,{type:r.RENAME,data:{oldPath:e,newPath:t}}));d(this,"createDir",e=>o(this,E).call(this,{type:r.CREATE_DIR,data:{path:e}}));d(this,"listDir",e=>o(this,E).call(this,{type:r.LIST_DIR,data:{path:e}}));d(this,"deleteDir",e=>o(this,E).call(this,{type:r.DELETE_DIR,data:{path:e}}))}on(e,t){e==="log"?o(this,w).push(t):e==="progress"&&o(this,m).push(t)}off(e,t){e==="log"?g(this,w,o(this,w).filter(s=>s!==t)):e==="progress"&&g(this,m,o(this,m).filter(s=>s!==t))}}l=new WeakMap,h=new WeakMap,u=new WeakMap,w=new WeakMap,m=new WeakMap,I=new WeakMap,E=new WeakMap;const Z=new Error("failed to get response body reader"),q=new Error("failed to complete download"),J="Content-Length",K=a=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{const{result:n}=s;n instanceof ArrayBuffer?e(new Uint8Array(n)):e(new Uint8Array)},s.onerror=n=>{var i,c;t(Error(`File could not be read! Code=${((c=(i=n==null?void 0:n.target)==null?void 0:i.error)==null?void 0:c.code)||-1}`))},s.readAsArrayBuffer(a)}),Q=async a=>{let e;if(typeof a=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(a)?e=atob(a.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(a)).arrayBuffer();else if(a instanceof URL)e=await(await fetch(a)).arrayBuffer();else if(a instanceof File||a instanceof Blob)e=await K(a);else return new Uint8Array;return new Uint8Array(e)},M=async(a,e)=>{var n;const t=await fetch(a);let s;try{const i=parseInt(t.headers.get(J)||"-1"),c=(n=t.body)==null?void 0:n.getReader();if(!c)throw Z;const f=[];let p=0;for(;;){const{done:L,value:A}=await c.read(),y=A?A.length:0;if(L){if(i!=-1&&i!==p)throw q;e&&e({url:a,total:i,received:p,delta:y,done:L});break}f.push(A),p+=y,e&&e({url:a,total:i,received:p,delta:y,done:L})}const D=new Uint8Array(p);let k=0;for(const L of f)D.set(L,k),k+=L.length;s=D.buffer}catch(i){console.log("failed to send download progress event: ",i),s=await t.arrayBuffer(),e&&e({url:a,total:s.byteLength,received:s.byteLength,delta:0,done:!0})}return s},v=async(a,e,t=!1,s)=>{const n=t?await M(a,s):await(await fetch(a)).arrayBuffer(),i=new Blob([n],{type:e});return URL.createObjectURL(i)},ee={class:"animation-wrapper"},te=R("h1",null,"動畫製作",-1),ae={class:"mt-4"},se={class:"time-bar"},oe=R("br",null,null,-1),re=["src"],O="https://unpkg.com/@ffmpeg/core-mt@0.12.2/dist/esm",ce=B({__name:"Animation",setup(a){const e=new H,t=b("Click Start to Transcode"),s=b(),n=async i=>{t.value="Loading ffmpeg-core.js",e.on("log",({type:p,message:D})=>{console.log(`Log: ${p}: ${D}`)}),await e.load({coreURL:await v(`${O}/ffmpeg-core.js`,"text/javascript"),wasmURL:await v(`${O}/ffmpeg-core.wasm`,"applicaiton/wasm"),workerURL:await v(`${O}/ffmpeg-core.worker.js`,"text/javascript")}),t.value="Start transcoding",await e.writeFile("test.mp4",await Q(i)),await e.exec(["-stream_loop","-1","-i","test.mp4","-filter:v","fps=5,scale=800:-1:flags=lanczos","-c:v","webp","-an","-ss","9","-to","13.3","-s","800:450","output.webp"]),t.value="Complete transcoding",console.log("1111");const c=await e.readFile("output.webp");console.log("2222");const f=c;s.value=URL.createObjectURL(new Blob([f.buffer],{type:"image/webp"})),console.log(`Array: ${f.length}, ${f.byteLength}`)};return(i,c)=>{const f=W;return S(),T("div",ee,[te,R("div",ae,[U(V,{onUpload:n}),R("div",se,[U(f,{type:"range"})]),oe,R("p",null,x(t.value),1),R("img",{src:s.value},null,8,re)])])}}});export{ce as default};
