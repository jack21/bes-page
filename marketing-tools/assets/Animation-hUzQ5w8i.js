var S=Object.defineProperty;var $=(a,e,t)=>e in a?S(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var d=(a,e,t)=>($(a,typeof e!="symbol"?e+"":e,t),t),C=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var o=(a,e,t)=>(C(a,e,"read from private field"),t?t.call(a):e.get(a)),h=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)},D=(a,e,t,s)=>(C(a,e,"write to private field"),s?s.call(a,t):e.set(a,t),t);import{d as B,r as U,w as j,o as v,a as N,e as T,b as L,p as P,$ as x,t as W,j as V,Z as G}from"./index-vj19Cfrc.js";const M={class:"youtube-preview-wrapper"},F=["src"],X=B({__name:"YoutubePreview",emits:["upload"],setup(a,{emit:e}){const t=e,s=U(),r=U("/ffmpeg/1920x1080.mp4");return j(s,()=>{!s||!s.value||(r.value=URL.createObjectURL(s.value),t("upload",s.value))}),(i,l)=>{const c=P;return v(),N("div",M,[T(c,{id:"video-upload",modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=f=>s.value=f),accept:"video/*"},null,8,["modelValue"]),L("video",{src:r.value,controls:"",class:"mt-3"},null,8,F)])}}});var n;(function(a){a.LOAD="LOAD",a.EXEC="EXEC",a.WRITE_FILE="WRITE_FILE",a.READ_FILE="READ_FILE",a.DELETE_FILE="DELETE_FILE",a.RENAME="RENAME",a.CREATE_DIR="CREATE_DIR",a.LIST_DIR="LIST_DIR",a.DELETE_DIR="DELETE_DIR",a.ERROR="ERROR",a.DOWNLOAD="DOWNLOAD",a.PROGRESS="PROGRESS",a.LOG="LOG",a.MOUNT="MOUNT",a.UNMOUNT="UNMOUNT"})(n||(n={}));const z=(()=>{let a=0;return()=>a++})(),H=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Y=new Error("called FFmpeg.terminate()");var u,R,p,m,_,O,E;class Z{constructor(){h(this,u,null);h(this,R,{});h(this,p,{});h(this,m,[]);h(this,_,[]);d(this,"loaded",!1);h(this,O,()=>{o(this,u)&&(o(this,u).onmessage=({data:{id:e,type:t,data:s}})=>{switch(t){case n.LOAD:this.loaded=!0,o(this,R)[e](s);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:o(this,R)[e](s);break;case n.LOG:o(this,m).forEach(r=>r(s));break;case n.PROGRESS:o(this,_).forEach(r=>r(s));break;case n.ERROR:o(this,p)[e](s);break}delete o(this,R)[e],delete o(this,p)[e]})});h(this,E,({type:e,data:t},s=[],r)=>o(this,u)?new Promise((i,l)=>{const c=z();o(this,u)&&o(this,u).postMessage({id:c,type:e,data:t},s),o(this,R)[c]=i,o(this,p)[c]=l,r==null||r.addEventListener("abort",()=>{l(new DOMException(`Message # ${c} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(H));d(this,"load",({classWorkerURL:e,...t}={},{signal:s}={})=>(o(this,u)||(D(this,u,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/bes-page/marketing-tools/assets/worker-nzAqrILV.js",import.meta.url),{type:"module"})),o(this,O).call(this)),o(this,E).call(this,{type:n.LOAD,data:t},void 0,s)));d(this,"exec",(e,t=-1,{signal:s}={})=>o(this,E).call(this,{type:n.EXEC,data:{args:e,timeout:t}},void 0,s));d(this,"terminate",()=>{const e=Object.keys(o(this,p));for(const t of e)o(this,p)[t](Y),delete o(this,p)[t],delete o(this,R)[t];o(this,u)&&(o(this,u).terminate(),D(this,u,null),this.loaded=!1)});d(this,"writeFile",(e,t,{signal:s}={})=>{const r=[];return t instanceof Uint8Array&&r.push(t.buffer),o(this,E).call(this,{type:n.WRITE_FILE,data:{path:e,data:t}},r,s)});d(this,"mount",(e,t,s)=>{const r=[];return o(this,E).call(this,{type:n.MOUNT,data:{fsType:e,options:t,mountPoint:s}},r)});d(this,"unmount",e=>{const t=[];return o(this,E).call(this,{type:n.UNMOUNT,data:{mountPoint:e}},t)});d(this,"readFile",(e,t="binary",{signal:s}={})=>o(this,E).call(this,{type:n.READ_FILE,data:{path:e,encoding:t}},void 0,s));d(this,"deleteFile",(e,{signal:t}={})=>o(this,E).call(this,{type:n.DELETE_FILE,data:{path:e}},void 0,t));d(this,"rename",(e,t,{signal:s}={})=>o(this,E).call(this,{type:n.RENAME,data:{oldPath:e,newPath:t}},void 0,s));d(this,"createDir",(e,{signal:t}={})=>o(this,E).call(this,{type:n.CREATE_DIR,data:{path:e}},void 0,t));d(this,"listDir",(e,{signal:t}={})=>o(this,E).call(this,{type:n.LIST_DIR,data:{path:e}},void 0,t));d(this,"deleteDir",(e,{signal:t}={})=>o(this,E).call(this,{type:n.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?o(this,m).push(t):e==="progress"&&o(this,_).push(t)}off(e,t){e==="log"?D(this,m,o(this,m).filter(s=>s!==t)):e==="progress"&&D(this,_,o(this,_).filter(s=>s!==t))}}u=new WeakMap,R=new WeakMap,p=new WeakMap,m=new WeakMap,_=new WeakMap,O=new WeakMap,E=new WeakMap;const q=new Error("failed to get response body reader"),J=new Error("failed to complete download"),K="Content-Length",Q=a=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{const{result:r}=s;r instanceof ArrayBuffer?e(new Uint8Array(r)):e(new Uint8Array)},s.onerror=r=>{var i,l;t(Error(`File could not be read! Code=${((l=(i=r==null?void 0:r.target)==null?void 0:i.error)==null?void 0:l.code)||-1}`))},s.readAsArrayBuffer(a)}),ee=async a=>{let e;if(typeof a=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(a)?e=atob(a.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(a)).arrayBuffer();else if(a instanceof URL)e=await(await fetch(a)).arrayBuffer();else if(a instanceof File||a instanceof Blob)e=await Q(a);else return new Uint8Array;return new Uint8Array(e)},te=async(a,e)=>{var r;const t=await fetch(a);let s;try{const i=parseInt(t.headers.get(K)||"-1"),l=(r=t.body)==null?void 0:r.getReader();if(!l)throw q;const c=[];let f=0;for(;;){const{done:w,value:b}=await l.read(),I=b?b.length:0;if(w){if(i!=-1&&i!==f)throw J;e&&e({url:a,total:i,received:f,delta:I,done:w});break}c.push(b),f+=I,e&&e({url:a,total:i,received:f,delta:I,done:w})}const g=new Uint8Array(f);let k=0;for(const w of c)g.set(w,k),k+=w.length;s=g.buffer}catch(i){console.log("failed to send download progress event: ",i),s=await t.arrayBuffer(),e&&e({url:a,total:s.byteLength,received:s.byteLength,delta:0,done:!0})}return s},A=async(a,e,t=!1,s)=>{const r=t?await te(a,s):await(await fetch(a)).arrayBuffer(),i=new Blob([r],{type:e});return URL.createObjectURL(i)},ae={class:"animation-wrapper"},se=L("h1",null,"動畫製作",-1),oe={class:"mt-4"},re={class:"time-bar"},ne=L("br",null,null,-1),ie=["src"],y="https://unpkg.com/@ffmpeg/core-mt@0.12.4/dist/esm",de=B({__name:"Animation",setup(a){const e=new Z,t=x(["Click Start to Transcode"]),s=U(),r=async i=>{t.push("start upload"),e.on("log",({type:f,message:g})=>{console.log(`[Animation] on ffmpeg log: ${f}: ${g}`)}),await e.load({coreURL:await A(`${y}/ffmpeg-core.js`,"text/javascript"),wasmURL:await A(`${y}/ffmpeg-core.wasm`,"application/wasm"),workerURL:await A(`${y}/ffmpeg-core.worker.js`,"text/javascript")}),t.push("Start transcoding"),await e.writeFile("test.mp4",await ee(i)),await e.exec(["-stream_loop","-1","-i","test.mp4","-filter:v","fps=5,scale=800:-1:flags=lanczos","-ss","9","-to","13.3","output.webp"]),t.push("Complete transcoding"),console.log("1111");const l=await e.readFile("output.webp");console.log("2222");const c=l;s.value=URL.createObjectURL(new Blob([c],{type:"image/webp"})),console.log(`Array: ${c.length}, ${c.byteLength}`)};return(i,l)=>{const c=G;return v(),N("div",ae,[se,L("div",oe,[T(X,{onUpload:r}),L("div",re,[T(c,{type:"range"})]),ne,L("p",null,W(t),1),s.value?(v(),N("img",{key:0,src:s.value},null,8,ie)):V("",!0)])])}}});export{de as default};
