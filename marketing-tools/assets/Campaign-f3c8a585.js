import{P as L,_ as D,a as A,b as G,c as N,d as M,e as P}from"./CampaignName.vue_vue_type_style_index_0_lang-cfd87d10.js";import{d as S,u as x,i as $,r as w,h as H,o,c as _,b as s,t as B,f as z,g as y,y as O,w as I,a as u,p as E,j as R,k as T,l as b,F as j}from"./index-507929e1.js";import"./index-b5aa446b.js";const q={class:"ta-file-wrapper"},W={key:0,class:"hint"},Z=S({__name:"CampaignImportTa",setup(C){const e=x(),m=$(),a=w([]),h=w(0),i=w(0);H(a,()=>{i.value=0,e.userArgSet.clear(),a.value.forEach(l=>d(l))});const d=l=>{L.parse(l,{header:!0,skipEmptyLines:!0,transformHeader:(t,r)=>(console.log(`Header: ${r}`,t),t==="特定用戶名單(TAMI專用)"?"groupName":t==="Subscr Id"?"subId":t==="台灣大會員編號"?"twmId":t==="目前方案專案V+D+V資費"?"tariff":t==="租期(月)"?"duration":(t.startsWith('"')||e.userArgSet.add(t),t)),complete:t=>{if(t.errors.length>0){alert("Parse Error");return}i.value+=t.data.length;const r=new Map;for(let c=0;c<t.data.length;c++){const n=t.data[c];r.set(n.twmId,n)}console.log(`[CampaignImportTa] add ${t.data.length} TA -> ${r.size} Users`),console.time("DB Insert");const g=Array.from(r.values());e.partition(g,3e3).forEach(c=>{var v;let n="(?,?,?,?),".repeat(c.length);n=n.substring(0,n.length-1),n=`INSERT INTO user (twm_id, sub_id, tariff, duration) VALUES ${n}`;const p=[];c.forEach(f=>{p.push(f.twmId),p.push(f.subId),p.push(f.tariff),p.push(f.duration)}),(v=m.db)==null||v.run(n,p)}),console.timeEnd("DB Insert"),console.log(`[CampaignImportTa] add ${r.size} Users Complete`)}})};return(l,t)=>{const r=O;return o(),_("div",q,[s(r,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=g=>a.value=g),label:"受眾 (BOE 匯出 csv)",accept:"text/csv",multiple:""},null,8,["modelValue"]),i.value>0?(o(),_("small",W," 載入 "+B(h.value)+" 群, "+B(i.value)+" 筆記錄, "+B(z(e).userArgSet.size)+" 參數 ",1)):y("",!0)])}}});const J={class:"campaign-config-wrapper"},K=u("span",null,"儲存簡訊活動",-1),Q=S({__name:"CampaignConfigFile",setup(C){const e=$(),m=async()=>{await e.saveDB()};return(a,h)=>{const i=D,d=E;return o(),_("div",J,[s(d,{variant:"outline-primary",size:"sm",onClick:m,class:"ms-1"},{default:I(()=>[s(i),K]),_:1})])}}});const X={class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Y=u("path",{fill:"currentColor",d:"M13 19c0 .34.04.67.09 1H4a2 2 0 0 1-2-2V6c0-1.11.89-2 2-2h6l2 2h8a2 2 0 0 1 2 2v5.81c-.61-.35-1.28-.59-2-.72V8H4v10h9.09c-.05.33-.09.66-.09 1m7-1v-3h-2v3h-3v2h3v3h2v-3h3v-2h-3Z"},null,-1),tt=[Y];function et(C,e){return o(),_("svg",X,[...tt])}const st={name:"mdi-folder-plus-outline",render:et},nt=u("h1",null,"行銷管理大平台",-1),ot={key:0,class:"first-view"},at=u("span",null,"建立新簡訊活動",-1),rt=u("span",null,"匯入簡訊活動",-1),it={key:1,class:"main"},ct={class:"title-wrapper section"},_t={class:"file-wrapper section"},lt={key:0,class:"main-wrapper section"},dt=S({__name:"Campaign",setup(C){const e=x(),m=$(),a=w(!1);R(async()=>{e.addUserTest("45564360","66737619","0935523767"),e.addUserTest("45764165","66783939","0935525530"),e.addUserTest("13520651","57674022","0972197982"),e.addUserTest("42731870","","0932087196"),e.addUserTest("45495665","66737900","0915055636"),e.addUserTest("40295784","65496240","0983085853")});const h=async()=>{await m.createDB(),a.value=!0},i=async()=>{const[t]=await window.showOpenFilePicker({id:"campaign-import-db",multiple:!1,types:[{accept:{"text/csv":[".db"]}}]});await m.importDB(t),a.value=!0},d=T(()=>e.groupList&&e.groupList.length>0),l=T(()=>e.smsGroupList&&e.smsGroupList.length>0);return(t,r)=>{const g=st,k=E,c=D,n=A,p=Q,v=Z,f=G,V=N,U=M,F=P;return o(),_(j,null,[nt,a.value?(o(),_("div",it,[u("section",ct,[s(n),s(p)]),u("section",_t,[s(v),s(f),s(V)]),d.value||l.value?(o(),_("section",lt,[d.value?(o(),b(U,{key:0})):y("",!0),l.value?(o(),b(F,{key:1})):y("",!0)])):y("",!0)])):(o(),_("div",ot,[s(k,{variant:"outline-primary",onClick:h},{default:I(()=>[s(g),at]),_:1}),s(k,{variant:"outline-primary",onClick:i,class:"ms-1"},{default:I(()=>[s(c),rt]),_:1})]))],64)}}});export{dt as default};
