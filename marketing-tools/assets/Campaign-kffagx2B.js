import{_ as D,a as L,b as A,c as G,d as N,e as M}from"./CampaignName.vue_vue_type_style_index_0_lang-_TVu1TvG.js";import{d as $,u as E,i as I,r as w,h as P,o,c as l,b as s,t as B,f as z,g as C,y as H,P as O,w as S,a as u,p as V,j as R,k as T,l as b,F as j}from"./index-RbTbl8Ls.js";import"./download--mlb07Lm.js";import"./delete-outline-WmHnczwm.js";const q={class:"ta-file-wrapper"},W={key:0,class:"hint"},J=$({__name:"CampaignImportTa",setup(k){const e=E(),m=I(),a=w([]),g=w(0),i=w(0);P(a,()=>{i.value=0,e.userArgSet.clear(),a.value.forEach(p=>d(p))});const d=p=>{O.parse(p,{header:!0,skipEmptyLines:!0,transformHeader:(t,r)=>(console.log(`Header: ${r}`,t),t==="特定用戶名單(TAMI專用)"?"groupName":t==="Subscr Id"?"subId":t==="台灣大會員編號"?"twmId":t==="目前方案專案V+D+V資費"?"tariff":t==="租期(月)"?"duration":(t.startsWith('"')||e.userArgSet.add(t),t)),complete:t=>{if(t.errors.length>0){alert("Parse Error");return}i.value+=t.data.length;const r=new Map;for(let c=0;c<t.data.length;c++){const n=t.data[c];r.set(n.twmId,n)}console.log(`[CampaignImportTa] add ${t.data.length} TA -> ${r.size} Users`),console.time("DB Insert");const h=Array.from(r.values());e.partition(h,3e3).forEach(c=>{var v;let n="(?,?,?,?),".repeat(c.length);n=n.substring(0,n.length-1),n=`INSERT INTO user (twm_id, sub_id, tariff, duration) VALUES ${n}`;const _=[];c.forEach(f=>{_.push(f.twmId),_.push(f.subId),_.push(f.tariff),_.push(f.duration)}),(v=m.db)==null||v.run(n,_)}),console.timeEnd("DB Insert"),console.log(`[CampaignImportTa] add ${r.size} Users Complete`)}})};return(p,t)=>{const r=H;return o(),l("div",q,[s(r,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=h=>a.value=h),label:"受眾 (BOE 匯出 csv)",accept:"text/csv",multiple:""},null,8,["modelValue"]),i.value>0?(o(),l("small",W," 載入 "+B(g.value)+" 群, "+B(i.value)+" 筆記錄, "+B(z(e).userArgSet.size)+" 參數 ",1)):C("",!0)])}}}),K={class:"campaign-config-wrapper"},Q=u("span",null,"儲存簡訊活動",-1),X=$({__name:"CampaignConfigFile",setup(k){const e=I(),m=async()=>{await e.saveDB()};return(a,g)=>{const i=D,d=V;return o(),l("div",K,[s(d,{variant:"outline-primary",size:"sm",onClick:m,class:"ms-1"},{default:S(()=>[s(i),Q]),_:1})])}}}),Y={class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Z=u("path",{fill:"currentColor",d:"M13 19c0 .34.04.67.09 1H4a2 2 0 0 1-2-2V6c0-1.11.89-2 2-2h6l2 2h8a2 2 0 0 1 2 2v5.81c-.61-.35-1.28-.59-2-.72V8H4v10h9.09c-.05.33-.09.66-.09 1m7-1v-3h-2v3h-3v2h3v3h2v-3h3v-2z"},null,-1),tt=[Z];function et(k,e){return o(),l("svg",Y,[...tt])}const st={name:"mdi-folder-plus-outline",render:et},nt=u("h1",null,"行銷管理大平台",-1),ot={key:0,class:"first-view"},at=u("span",null,"建立新簡訊活動",-1),rt=u("span",null,"匯入簡訊活動",-1),it={key:1,class:"main"},ct={class:"title-wrapper section"},lt={class:"file-wrapper section"},pt={key:0,class:"main-wrapper section"},ft=$({__name:"Campaign",setup(k){const e=E(),m=I(),a=w(!1);R(async()=>{e.addUserTest("45564360","66737619","0935523767"),e.addUserTest("45764165","66783939","0935525530"),e.addUserTest("13520651","57674022","0972197982"),e.addUserTest("42731870","","0932087196"),e.addUserTest("45495665","66737900","0915055636"),e.addUserTest("40295784","65496240","0983085853")});const g=async()=>{await m.createDB(),a.value=!0},i=async()=>{const[t]=await window.showOpenFilePicker({id:"campaign-import-db",multiple:!1,types:[{accept:{"text/csv":[".db"]}}]});await m.importDB(t),a.value=!0},d=T(()=>e.groupList&&e.groupList.length>0),p=T(()=>e.smsGroupList&&e.smsGroupList.length>0);return(t,r)=>{const h=st,y=V,c=D,n=L,_=X,v=J,f=A,x=G,U=N,F=M;return o(),l(j,null,[nt,a.value?(o(),l("div",it,[u("section",ct,[s(n),s(_)]),u("section",lt,[s(v),s(f),s(x)]),d.value||p.value?(o(),l("section",pt,[d.value?(o(),b(U,{key:0})):C("",!0),p.value?(o(),b(F,{key:1})):C("",!0)])):C("",!0)])):(o(),l("div",ot,[s(y,{variant:"outline-primary",onClick:g},{default:S(()=>[s(h),at]),_:1}),s(y,{variant:"outline-primary",onClick:i,class:"ms-1"},{default:S(()=>[s(c),rt]),_:1})]))],64)}}});export{ft as default};
