import{o as F,c as H,a as R,m as st,n as nt,d as ye,u as we,r as U,k as ve,h as Ne,b as s,w as i,l as me,g as pe,t as B,q as Ge,s as ot,v as it,p as ee,x as at,y as Ze,z as Ae,A as De,i as rt,e as C,F as Re,f as ue,B as Be,C as lt,D as ut,I as ct,E as dt,Q as mt,G as pt,H as Ue,J as Pe,O as Ve,K as je,L as He,M as qe,Y as ft,N as ht,P as _t,T as Je,R as Ye,U as gt,S as vt,j as Xe,V as bt}from"./index-xZd3i5kS.js";import{_ as We,i as yt,b as wt}from"./index-Hoo_MgR2.js";const Ct={class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},St=R("path",{fill:"currentColor",d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z"},null,-1),xt=[St];function Lt(ie,u){return F(),H("svg",Ct,[...xt])}const Ke={name:"mdi-close",render:Lt};var et={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(ie,u){(function(f,p){ie.exports=p()})(st,function f(){var p=typeof self<"u"?self:typeof window<"u"?window:p!==void 0?p:{},L=!p.document&&!!p.postMessage,I=p.IS_PAPA_WORKER||!1,T={},N=0,d={parse:function(e,t){var n=(t=t||{}).dynamicTyping||!1;if(l(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=!!l(t.transform)&&t.transform,t.worker&&d.WORKERS_SUPPORTED){var r=function(){if(!d.WORKERS_SUPPORTED)return!1;var c=(G=p.URL||p.webkitURL||null,z=f.toString(),d.BLOB_URL||(d.BLOB_URL=G.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",z,")();"],{type:"text/javascript"})))),b=new p.Worker(c),G,z;return b.onmessage=ne,b.id=N++,T[b.id]=b}();return r.userStep=t.step,r.userChunk=t.chunk,r.userComplete=t.complete,r.userError=t.error,t.step=l(t.step),t.chunk=l(t.chunk),t.complete=l(t.complete),t.error=l(t.error),delete t.worker,void r.postMessage({input:e,config:t,workerId:r.id})}var o=null;return d.NODE_STREAM_INPUT,typeof e=="string"?(e=function(c){return c.charCodeAt(0)===65279?c.slice(1):c}(e),o=t.download?new _(t):new y(t)):e.readable===!0&&l(e.read)&&l(e.on)?o=new k(t):(p.File&&e instanceof File||e instanceof Object)&&(o=new v(t)),o.stream(e)},unparse:function(e,t){var n=!1,r=!0,o=",",c=`\r
`,b='"',G=b+b,z=!1,h=null,V=!1;(function(){if(typeof t=="object"){if(typeof t.delimiter!="string"||d.BAD_DELIMITERS.filter(function(g){return t.delimiter.indexOf(g)!==-1}).length||(o=t.delimiter),(typeof t.quotes=="boolean"||typeof t.quotes=="function"||Array.isArray(t.quotes))&&(n=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(z=t.skipEmptyLines),typeof t.newline=="string"&&(c=t.newline),typeof t.quoteChar=="string"&&(b=t.quoteChar),typeof t.header=="boolean"&&(r=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");h=t.columns}t.escapeChar!==void 0&&(G=t.escapeChar+b),(typeof t.escapeFormulae=="boolean"||t.escapeFormulae instanceof RegExp)&&(V=t.escapeFormulae instanceof RegExp?t.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var w=new RegExp(P(b),"g");if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return le(null,e,z);if(typeof e[0]=="object")return le(h||Object.keys(e[0]),e,z)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||h),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),le(e.fields||[],e.data||[],z);throw new Error("Unable to serialize unrecognized input");function le(g,$,K){var Q="";typeof g=="string"&&(g=JSON.parse(g)),typeof $=="string"&&($=JSON.parse($));var te=Array.isArray(g)&&0<g.length,ae=!Array.isArray($[0]);if(te&&r){for(var re=0;re<g.length;re++)0<re&&(Q+=o),Q+=Z(g[re],re);0<$.length&&(Q+=c)}for(var x=0;x<$.length;x++){var A=te?g.length:$[x].length,J=!1,oe=te?Object.keys($[x]).length===0:$[x].length===0;if(K&&!te&&(J=K==="greedy"?$[x].join("").trim()==="":$[x].length===1&&$[x][0].length===0),K==="greedy"&&te){for(var j=[],ce=0;ce<A;ce++){var X=ae?g[ce]:ce;j.push($[x][X])}J=j.join("").trim()===""}if(!J){for(var W=0;W<A;W++){0<W&&!oe&&(Q+=o);var be=te&&ae?g[W]:W;Q+=Z($[x][be],W)}x<$.length-1&&(!K||0<A&&!oe)&&(Q+=c)}}return Q}function Z(g,$){if(g==null)return"";if(g.constructor===Date)return JSON.stringify(g).slice(1,25);var K=!1;V&&typeof g=="string"&&V.test(g)&&(g="'"+g,K=!0);var Q=g.toString().replace(w,G);return(K=K||n===!0||typeof n=="function"&&n(g,$)||Array.isArray(n)&&n[$]||function(te,ae){for(var re=0;re<ae.length;re++)if(-1<te.indexOf(ae[re]))return!0;return!1}(Q,d.BAD_DELIMITERS)||-1<Q.indexOf(o)||Q.charAt(0)===" "||Q.charAt(Q.length-1)===" ")?b+Q+b:Q}}};if(d.RECORD_SEP="",d.UNIT_SEP="",d.BYTE_ORDER_MARK="\uFEFF",d.BAD_DELIMITERS=["\r",`
`,'"',d.BYTE_ORDER_MARK],d.WORKERS_SUPPORTED=!L&&!!p.Worker,d.NODE_STREAM_INPUT=1,d.LocalChunkSize=10485760,d.RemoteChunkSize=5242880,d.DefaultDelimiter=",",d.Parser=q,d.ParserHandle=M,d.NetworkStreamer=_,d.FileStreamer=v,d.StringStreamer=y,d.ReadableStreamStreamer=k,p.jQuery){var S=p.jQuery;S.fn.parse=function(e){var t=e.config||{},n=[];return this.each(function(c){if(!(S(this).prop("tagName").toUpperCase()==="INPUT"&&S(this).attr("type").toLowerCase()==="file"&&p.FileReader)||!this.files||this.files.length===0)return!0;for(var b=0;b<this.files.length;b++)n.push({file:this.files[b],inputElem:this,instanceConfig:S.extend({},t)})}),r(),this;function r(){if(n.length!==0){var c,b,G,z,h=n[0];if(l(e.before)){var V=e.before(h.file,h.inputElem);if(typeof V=="object"){if(V.action==="abort")return c="AbortError",b=h.file,G=h.inputElem,z=V.reason,void(l(e.error)&&e.error({name:c},b,G,z));if(V.action==="skip")return void o();typeof V.config=="object"&&(h.instanceConfig=S.extend(h.instanceConfig,V.config))}else if(V==="skip")return void o()}var w=h.instanceConfig.complete;h.instanceConfig.complete=function(le){l(w)&&w(le,h.file,h.inputElem),o()},d.parse(h.file,h.instanceConfig)}else l(e.complete)&&e.complete()}function o(){n.splice(0,1),r()}}}function m(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var n=E(t);n.chunkSize=parseInt(n.chunkSize),t.step||t.chunk||(n.chunkSize=null),this._handle=new M(n),(this._handle.streamer=this)._config=n}).call(this,e),this.parseChunk=function(t,n){if(this.isFirstChunk&&l(this._config.beforeFirstChunk)){var r=this._config.beforeFirstChunk(t);r!==void 0&&(t=r)}this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+t;this._partialLine="";var c=this._handle.parse(o,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var b=c.meta.cursor;this._finished||(this._partialLine=o.substring(b-this._baseIndex),this._baseIndex=b),c&&c.data&&(this._rowCount+=c.data.length);var G=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(I)p.postMessage({results:c,workerId:d.WORKER_ID,finished:G});else if(l(this._config.chunk)&&!n){if(this._config.chunk(c,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);c=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(c.data),this._completeResults.errors=this._completeResults.errors.concat(c.errors),this._completeResults.meta=c.meta),this._completed||!G||!l(this._config.complete)||c&&c.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),G||c&&c.meta.paused||this._nextChunk(),c}this._halted=!0},this._sendError=function(t){l(this._config.error)?this._config.error(t):I&&this._config.error&&p.postMessage({workerId:d.WORKER_ID,error:t,finished:!1})}}function _(e){var t;(e=e||{}).chunkSize||(e.chunkSize=d.RemoteChunkSize),m.call(this,e),this._nextChunk=L?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(n){this._input=n,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),L||(t.onload=a(this._chunkLoaded,this),t.onerror=a(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!L),this._config.downloadRequestHeaders){var n=this._config.downloadRequestHeaders;for(var r in n)t.setRequestHeader(r,n[r])}if(this._config.chunkSize){var o=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+o)}try{t.send(this._config.downloadRequestBody)}catch(c){this._chunkError(c.message)}L&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(n){var r=n.getResponseHeader("Content-Range");return r===null?-1:parseInt(r.substring(r.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(n){var r=t.statusText||n;this._sendError(new Error(r))}}function v(e){var t,n;(e=e||{}).chunkSize||(e.chunkSize=d.LocalChunkSize),m.call(this,e);var r=typeof FileReader<"u";this.stream=function(o){this._input=o,n=o.slice||o.webkitSlice||o.mozSlice,r?((t=new FileReader).onload=a(this._chunkLoaded,this),t.onerror=a(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var o=this._input;if(this._config.chunkSize){var c=Math.min(this._start+this._config.chunkSize,this._input.size);o=n.call(o,this._start,c)}var b=t.readAsText(o,this._config.encoding);r||this._chunkLoaded({target:{result:b}})},this._chunkLoaded=function(o){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(o.target.result)},this._chunkError=function(){this._sendError(t.error)}}function y(e){var t;m.call(this,e=e||{}),this.stream=function(n){return t=n,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var n,r=this._config.chunkSize;return r?(n=t.substring(0,r),t=t.substring(r)):(n=t,t=""),this._finished=!t,this.parseChunk(n)}}}function k(e){m.call(this,e=e||{});var t=[],n=!0,r=!1;this.pause=function(){m.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){m.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(o){this._input=o,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=a(function(o){try{t.push(typeof o=="string"?o:o.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(c){this._streamError(c)}},this),this._streamError=a(function(o){this._streamCleanUp(),this._sendError(o)},this),this._streamEnd=a(function(){this._streamCleanUp(),r=!0,this._streamData("")},this),this._streamCleanUp=a(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function M(e){var t,n,r,o=Math.pow(2,53),c=-o,b=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,G=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,z=this,h=0,V=0,w=!1,le=!1,Z=[],g={data:[],errors:[],meta:{}};if(l(e.step)){var $=e.step;e.step=function(x){if(g=x,te())Q();else{if(Q(),g.data.length===0)return;h+=x.data.length,e.preview&&h>e.preview?n.abort():(g.data=g.data[0],$(g,z))}}}function K(x){return e.skipEmptyLines==="greedy"?x.join("").trim()==="":x.length===1&&x[0].length===0}function Q(){return g&&r&&(re("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+d.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines&&(g.data=g.data.filter(function(x){return!K(x)})),te()&&function(){if(!g)return;function x(J,oe){l(e.transformHeader)&&(J=e.transformHeader(J,oe)),Z.push(J)}if(Array.isArray(g.data[0])){for(var A=0;te()&&A<g.data.length;A++)g.data[A].forEach(x);g.data.splice(0,1)}else g.data.forEach(x)}(),function(){if(!g||!e.header&&!e.dynamicTyping&&!e.transform)return g;function x(J,oe){var j,ce=e.header?{}:[];for(j=0;j<J.length;j++){var X=j,W=J[j];e.header&&(X=j>=Z.length?"__parsed_extra":Z[j]),e.transform&&(W=e.transform(W,X)),W=ae(X,W),X==="__parsed_extra"?(ce[X]=ce[X]||[],ce[X].push(W)):ce[X]=W}return e.header&&(j>Z.length?re("FieldMismatch","TooManyFields","Too many fields: expected "+Z.length+" fields but parsed "+j,V+oe):j<Z.length&&re("FieldMismatch","TooFewFields","Too few fields: expected "+Z.length+" fields but parsed "+j,V+oe)),ce}var A=1;return!g.data.length||Array.isArray(g.data[0])?(g.data=g.data.map(x),A=g.data.length):g.data=x(g.data,0),e.header&&g.meta&&(g.meta.fields=Z),V+=A,g}()}function te(){return e.header&&Z.length===0}function ae(x,A){return J=x,e.dynamicTypingFunction&&e.dynamicTyping[J]===void 0&&(e.dynamicTyping[J]=e.dynamicTypingFunction(J)),(e.dynamicTyping[J]||e.dynamicTyping)===!0?A==="true"||A==="TRUE"||A!=="false"&&A!=="FALSE"&&(function(oe){if(b.test(oe)){var j=parseFloat(oe);if(c<j&&j<o)return!0}return!1}(A)?parseFloat(A):G.test(A)?new Date(A):A===""?null:A):A;var J}function re(x,A,J,oe){var j={type:x,code:A,message:J};oe!==void 0&&(j.row=oe),g.errors.push(j)}this.parse=function(x,A,J){var oe=e.quoteChar||'"';if(e.newline||(e.newline=function(X,W){X=X.substring(0,1048576);var be=new RegExp(P(W)+"([^]*?)"+P(W),"gm"),fe=(X=X.replace(be,"")).split("\r"),Ce=X.split(`
`),Se=1<Ce.length&&Ce[0].length<fe[0].length;if(fe.length===1||Se)return`
`;for(var he=0,Y=0;Y<fe.length;Y++)fe[Y][0]===`
`&&he++;return he>=fe.length/2?`\r
`:"\r"}(x,oe)),r=!1,e.delimiter)l(e.delimiter)&&(e.delimiter=e.delimiter(x),g.meta.delimiter=e.delimiter);else{var j=function(X,W,be,fe,Ce){var Se,he,Y,se;Ce=Ce||[",","	","|",";",d.RECORD_SEP,d.UNIT_SEP];for(var Te=0;Te<Ce.length;Te++){var D=Ce[Te],Fe=0,xe=0,Ee=0;Y=void 0;for(var Le=new q({comments:fe,delimiter:D,newline:W,preview:10}).parse(X),ke=0;ke<Le.data.length;ke++)if(be&&K(Le.data[ke]))Ee++;else{var Ie=Le.data[ke].length;xe+=Ie,Y!==void 0?0<Ie&&(Fe+=Math.abs(Ie-Y),Y=Ie):Y=Ie}0<Le.data.length&&(xe/=Le.data.length-Ee),(he===void 0||Fe<=he)&&(se===void 0||se<xe)&&1.99<xe&&(he=Fe,Se=D,se=xe)}return{successful:!!(e.delimiter=Se),bestDelimiter:Se}}(x,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);j.successful?e.delimiter=j.bestDelimiter:(r=!0,e.delimiter=d.DefaultDelimiter),g.meta.delimiter=e.delimiter}var ce=E(e);return e.preview&&e.header&&ce.preview++,t=x,n=new q(ce),g=n.parse(t,A,J),Q(),w?{meta:{paused:!0}}:g||{meta:{paused:!1}}},this.paused=function(){return w},this.pause=function(){w=!0,n.abort(),t=l(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){z.streamer._halted?(w=!1,z.streamer.parseChunk(t,!0)):setTimeout(z.resume,3)},this.aborted=function(){return le},this.abort=function(){le=!0,n.abort(),g.meta.aborted=!0,l(e.complete)&&e.complete(g),t=""}}function P(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function q(e){var t,n=(e=e||{}).delimiter,r=e.newline,o=e.comments,c=e.step,b=e.preview,G=e.fastMode,z=t=e.quoteChar===void 0||e.quoteChar===null?'"':e.quoteChar;if(e.escapeChar!==void 0&&(z=e.escapeChar),(typeof n!="string"||-1<d.BAD_DELIMITERS.indexOf(n))&&(n=","),o===n)throw new Error("Comment character same as delimiter");o===!0?o="#":(typeof o!="string"||-1<d.BAD_DELIMITERS.indexOf(o))&&(o=!1),r!==`
`&&r!=="\r"&&r!==`\r
`&&(r=`
`);var h=0,V=!1;this.parse=function(w,le,Z){if(typeof w!="string")throw new Error("Input must be a string");var g=w.length,$=n.length,K=r.length,Q=o.length,te=l(c),ae=[],re=[],x=[],A=h=0;if(!w)return _e();if(e.header&&!le){var J=w.split(r)[0].split(n),oe=[],j={},ce=!1;for(var X in J){var W=J[X];l(e.transformHeader)&&(W=e.transformHeader(W,X));var be=W,fe=j[W]||0;for(0<fe&&(ce=!0,be=W+"_"+fe),j[W]=fe+1;oe.includes(be);)be=be+"_"+fe;oe.push(be)}if(ce){var Ce=w.split(r);Ce[0]=oe.join(n),w=Ce.join(r)}}if(G||G!==!1&&w.indexOf(t)===-1){for(var Se=w.split(r),he=0;he<Se.length;he++){if(x=Se[he],h+=x.length,he!==Se.length-1)h+=r.length;else if(Z)return _e();if(!o||x.substring(0,Q)!==o){if(te){if(ae=[],Ee(x.split(n)),Me(),V)return _e()}else Ee(x.split(n));if(b&&b<=he)return ae=ae.slice(0,b),_e(!0)}}return _e()}for(var Y=w.indexOf(n,h),se=w.indexOf(r,h),Te=new RegExp(P(z)+P(t),"g"),D=w.indexOf(t,h);;)if(w[h]!==t)if(o&&x.length===0&&w.substring(h,h+Q)===o){if(se===-1)return _e();h=se+K,se=w.indexOf(r,h),Y=w.indexOf(n,h)}else if(Y!==-1&&(Y<se||se===-1))x.push(w.substring(h,Y)),h=Y+$,Y=w.indexOf(n,h);else{if(se===-1)break;if(x.push(w.substring(h,se)),Ie(se+K),te&&(Me(),V))return _e();if(b&&ae.length>=b)return _e(!0)}else for(D=h,h++;;){if((D=w.indexOf(t,D+1))===-1)return Z||re.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ae.length,index:h}),ke();if(D===g-1)return ke(w.substring(h,D).replace(Te,t));if(t!==z||w[D+1]!==z){if(t===z||D===0||w[D-1]!==z){Y!==-1&&Y<D+1&&(Y=w.indexOf(n,D+1)),se!==-1&&se<D+1&&(se=w.indexOf(r,D+1));var Fe=Le(se===-1?Y:Math.min(Y,se));if(w.substr(D+1+Fe,$)===n){x.push(w.substring(h,D).replace(Te,t)),w[h=D+1+Fe+$]!==t&&(D=w.indexOf(t,h)),Y=w.indexOf(n,h),se=w.indexOf(r,h);break}var xe=Le(se);if(w.substring(D+1+xe,D+1+xe+K)===r){if(x.push(w.substring(h,D).replace(Te,t)),Ie(D+1+xe+K),Y=w.indexOf(n,h),D=w.indexOf(t,h),te&&(Me(),V))return _e();if(b&&ae.length>=b)return _e(!0);break}re.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ae.length,index:h}),D++}}else D++}return ke();function Ee(ge){ae.push(ge),A=h}function Le(ge){var Qe=0;if(ge!==-1){var ze=w.substring(D+1,ge);ze&&ze.trim()===""&&(Qe=ze.length)}return Qe}function ke(ge){return Z||(ge===void 0&&(ge=w.substring(h)),x.push(ge),h=g,Ee(x),te&&Me()),_e()}function Ie(ge){h=ge,Ee(x),x=[],se=w.indexOf(r,h)}function _e(ge){return{data:ae,errors:re,meta:{delimiter:n,linebreak:r,aborted:V,truncated:!!ge,cursor:A+(le||0)}}}function Me(){c(_e()),ae=[],re=[]}},this.abort=function(){V=!0},this.getCharIndex=function(){return h}}function ne(e){var t=e.data,n=T[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var o={abort:function(){r=!0,de(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:O,resume:O};if(l(n.userStep)){for(var c=0;c<t.results.data.length&&(n.userStep({data:t.results.data[c],errors:t.results.errors,meta:t.results.meta},o),!r);c++);delete t.results}else l(n.userChunk)&&(n.userChunk(t.results,o,t.file),delete t.results)}t.finished&&!r&&de(t.workerId,t.results)}function de(e,t){var n=T[e];l(n.userComplete)&&n.userComplete(t),n.terminate(),delete T[e]}function O(){throw new Error("Not implemented.")}function E(e){if(typeof e!="object"||e===null)return e;var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=E(e[n]);return t}function a(e,t){return function(){e.apply(t,arguments)}}function l(e){return typeof e=="function"}return I&&(p.onmessage=function(e){var t=e.data;if(d.WORKER_ID===void 0&&t&&(d.WORKER_ID=t.workerId),typeof t.input=="string")p.postMessage({workerId:d.WORKER_ID,results:d.parse(t.input,t.config),finished:!0});else if(p.File&&t.input instanceof File||t.input instanceof Object){var n=d.parse(t.input,t.config);n&&p.postMessage({workerId:d.WORKER_ID,results:n,finished:!0})}}),(_.prototype=Object.create(m.prototype)).constructor=_,(v.prototype=Object.create(m.prototype)).constructor=v,(y.prototype=Object.create(y.prototype)).constructor=y,(k.prototype=Object.create(m.prototype)).constructor=k,d})})(et);var kt=et.exports;const $e=nt(kt),It={class:"export-sms-file"},$t=R("span",null,"門號 (商務簡訊)",-1),Tt={key:0,class:"ms-4 mt-2"},Et={class:"d-flex mt-2 align-items-center w-100"},Ft={key:0,class:"hint"},Nt={key:1,class:"error"},Gt=ye({__name:"ExportSmsFile",props:{disabled:{type:Boolean}},setup(ie){const u=ie,f=we(),p=U(!1),L=U([]),I=U([]),T=U(0),N=U(0),d=U(new Set),S=U([]),m=U(),_={text:"匯入 91 優惠券",value:"upload-file"},v=ve(()=>{const O=Array.from(f.userArgSet).map(E=>({text:E,value:E}));return O.push(_),O}),y=ve(()=>L.value.findIndex(O=>O===_.value)>=0);Ne(I,()=>{T.value=I.value.length,I.value.forEach(O=>k(O))});const k=O=>{$e.parse(O,{header:!0,skipEmptyLines:!0,encoding:"big5",transformHeader:(E,a)=>(console.log(`Header: ${a}`,E),E==="領取券號"?"couponCode":E==="是否領取"?"isRedeem":E),complete:E=>{if(E.errors.length>0){alert("Parse Error");return}const a=S.value.length;E.data.forEach(e=>{if(e.isRedeem.indexOf("否")===-1){console.log(`[ExportSmsFile] Coupon Code redeem: ${e.couponCode} -> ${e.isRedeem}`);return}if(d.value.has(e.couponCode)){console.log(`[ExportSmsFile] Coupon Code duplicated: ${e.couponCode}`);return}d.value.add(e.couponCode),S.value.push(e.couponCode)});const l=S.value.length;console.log(`[ExportSmsFile] read ${E.data.length} -> ${l-a} coupon Code`),T.value--,N.value++}})},M=ve(()=>T.value>0),P=()=>{p.value=!0},q=()=>{m.value=void 0;const O=[],E=Ge(new Date,"yyyyMMdd");let a=0,l=0;const e=f.smsGroupList,t=[],n=[];for(let G=0;G<e.length;G++){const z=e[G];console.log(`[ExportSmsFile] smsGroup: ${z.name}: ${z.smsSendInfoList.length}`),a+=z.smsSendInfoList.length;for(let h=0;h<z.smsSendInfoList.length;h++){const V=z.smsSendInfoList[h],w=ne(V);l+=w.length,console.log(`[ExportSmsFile] smsGroup: ${z.name}: [${h+1}] ${w.length}`),n.push(w.length);const le=f.partition(w,5e3);for(let Z=0;Z<le.length;Z++){const g=le[Z],$=$e.unparse(g,{delimiter:"	"}),K=z.smsSendInfoList.length===1?"":`_${h+1}`,Q=le.length===1?"":`_${Z+1}`,te=`${f.campaignName}_商務簡訊_${E}_${G+1}${K}${Q}_${z.name}_${g.length}.txt`;O.push({fileName:te,data:$}),t.push({smsText:V.text,phoneNumberFileName:te,smsCount:g.length})}}}const r={};r.sendHour=ot.Hour18,r.sendMinute=it.Minute00,r.smsList=t;const o=`${f.campaignName}_商務簡訊_${E}_${e.length}受眾_${a}群_${l}.cfg`,c=JSON.stringify(r);O.push({fileName:o,data:c});const b=`${f.campaignName}_商務簡訊_${E}_${e.length}受眾_${a}群_${l}.zip`;f.downloadZip(b,O),console.log(`受眾表用
${n.join(`
`)}`)},ne=O=>{const E=[],a=O.phoneNumberList;for(let l=0;l<a.length;l++){const e=a[l];if(e==="0979940180")continue;const t=f.phoneNumberUserMap.get(e);if(!t)continue;const n=[e];for(let r=0;r<v.value.length;r++){const o=v.value[r];if(L.value.findIndex(b=>b===o.value)>=0)if(o.value===_.value){const b=S.value[E.length];t.couponCode=b,n.push(b)}else t.params&&n.push(t.params[o.value])}E.push(n)}return E},de=()=>{I.value=[],N.value=0,S.value.length=0,d.value.clear()};return(O,E)=>{const a=We,l=ee,e=at,t=Ze,n=Ke,r=Ae,o=De;return F(),H("div",It,[s(l,{variant:"outline-primary",size:"sm",onClick:P,disabled:u.disabled},{default:i(()=>[s(a),$t]),_:1},8,["disabled"]),s(o,{modelValue:p.value,"onUpdate:modelValue":E[2]||(E[2]=c=>p.value=c),"ok-title":"匯出","cancel-title":"取消","cancel-variant":"outline-secondary",onOk:q,title:"參數",class:"args-modal"},{default:i(()=>[s(e,{modelValue:L.value,"onUpdate:modelValue":E[0]||(E[0]=c=>L.value=c),options:v.value,stacked:""},null,8,["modelValue","options"]),y.value?(F(),H("div",Tt,[R("div",Et,[s(t,{modelValue:I.value,"onUpdate:modelValue":E[1]||(E[1]=c=>I.value=c),id:"dsc-file",accept:"text/csv",multiple:""},null,8,["modelValue"]),d.value.size>0&&!M.value?(F(),me(l,{key:0,variant:"outline-primary",size:"sm",class:"remove ms-1",onClick:de},{default:i(()=>[s(n)]),_:1})):pe("",!0),M.value?(F(),me(r,{key:1,variant:"primary",class:"ms-1"})):pe("",!0)]),N.value?(F(),H("small",Ft,"已讀取 "+B(N.value)+" 檔案, "+B(d.value.size)+" 筆記錄",1)):pe("",!0)])):pe("",!0),m.value?(F(),H("p",Nt,B(m.value),1)):pe("",!0)]),_:1},8,["modelValue"])])}}}),Rt={class:"export-sms-file"},Bt=R("span",null,"門號 (客服)",-1),Mt=ye({__name:"ExportCustomServiceFile",props:{disabled:{type:Boolean}},setup(ie){const u=ie,f=we(),p=()=>{const L=Ge(new Date,"yyyyMMdd"),I=f.smsGroupList.filter(m=>m.smsPhoneNumberFilted.length>0),T=[];let N=0,d=0;for(let m=0;m<I.length;m++){const _=I[m];for(let v=0;v<_.smsSendInfoList.length;v++){d++;const y=_.smsSendInfoList[v],k=`用戶分群: ${_.name}\r
簡訊內容: ${y.text}\r
發送數量: ${y.phoneNumberList.length}\r
`,M=`${f.campaignName}_客服_${L}_${d}_發送資訊.txt`;T.push({fileName:M,data:k});const P=[];y.phoneNumberList.forEach(ne=>P.push([ne])),N+=y.phoneNumberList.length;const q=f.partition(P,5e4);for(let ne=0;ne<q.length;ne++){const de=q[ne],O=$e.unparse(de),E=q.length===1?"":`_${ne+1}`,a=`${f.campaignName}_客服_${L}_${d}_門號${E}_${de.length}.txt`;T.push({fileName:a,data:O})}}}const S=`${f.campaignName}_客服_${L}_${d}群_${N}人.zip`;f.downloadZip(S,T)};return(L,I)=>{const T=We,N=ee;return F(),H("div",Rt,[s(N,{variant:"outline-primary",size:"sm",class:"mt-1",onClick:p,disabled:u.disabled},{default:i(()=>[s(T),Bt]),_:1},8,["disabled"])])}}}),Ot={key:0,class:"sms-send"},zt=R("h6",{class:"title"},"分群測試",-1),At={class:"section"},Dt=R("h6",{class:"title"},"簡訊內容",-1),Ut={class:"sms-item section"},Pt={class:"sms-header"},Vt=["for"],jt={class:"count"},Ht={class:"sms-footer"},qt=ye({__name:"SmsSendModal",props:{smsGroup:{}},setup(ie){const u=rt(),f=we(),p=ie,L=U(!1),I=U(1),T=U(["","",""]),N=y=>{const k=p.smsGroup.smsPhoneNumberFilted;if(k.length===0)return[];const M=Math.ceil(k.length/I.value);return f.partition(k,M)[y]},d=()=>{I.value=Math.max(p.smsGroup.smsSendInfoList.length,1),T.value.length=0,p.smsGroup.smsSendInfoList.forEach(y=>{T.value.push(y.text)}),L.value=!0},S=()=>{if(!p.smsGroup)return;const y=T.value.splice(0,I.value);f.fillSmsSendInfo(p.smsGroup,y),u.setSmsText(p.smsGroup.name,y)},m=y=>y?y.length:0,_=y=>{const k=m(T.value[y]);return k===0?null:k<=70},v=(y,k)=>{if(k.phoneNumber){const M=f.sms(T.value[y],k.phoneNumber);console.log(`[SmsSend] URL: ${M}`),window.open(M,"_blank")}};return(y,k)=>{const M=ee,P=ut,q=ct,ne=dt,de=mt,O=pt,E=De;return p.smsGroup?(F(),H("div",Ot,[s(M,{variant:"outline-primary",size:"sm",onClick:d,disabled:p.smsGroup.smsPhoneNumberFilted.length===0},{default:i(()=>[R("span",null,"編輯 ("+B(p.smsGroup.smsSendInfoList.length)+")",1)]),_:1},8,["disabled"]),s(E,{modelValue:L.value,"onUpdate:modelValue":k[1]||(k[1]=a=>L.value=a),"ok-title":"確定","cancel-title":"取消","cancel-variant":"outline-secondary",onOk:S,class:"sms-send-modal"},{default:i(()=>[R("section",null,[zt,R("div",At,[s(q,{modelValue:I.value,"onUpdate:modelValue":k[0]||(k[0]=a=>I.value=a),name:"sms-test-group"},{default:i(()=>[s(P,{value:1},{default:i(()=>[C("不測試")]),_:1}),s(P,{value:2},{default:i(()=>[C("分兩群測試")]),_:1}),s(P,{value:3},{default:i(()=>[C("分三群測試")]),_:1})]),_:1},8,["modelValue"])])]),R("section",null,[Dt,(F(!0),H(Re,null,Be(I.value,a=>(F(),H("div",Ut,[R("div",Pt,[R("label",{for:`sms-text-${a}`},"簡訊 "+B(a),9,Vt),R("span",jt,B(N(a-1).length)+" 人",1)]),s(ne,{type:"text",size:"sm",id:`sms-text-${a}`,rows:"3",state:_(a-1),placeholder:"簡訊文案",modelValue:T.value[a-1],"onUpdate:modelValue":l=>T.value[a-1]=l},null,8,["id","state","modelValue","onUpdate:modelValue"]),R("div",Ht,[s(O,{right:"",variant:"outline-primary",size:"sm",text:"測試"},{default:i(()=>[(F(!0),H(Re,null,Be(ue(f).userInfoListTest,l=>(F(),me(de,{onClick:e=>v(a-1,l),key:l.twmId},{default:i(()=>[C(B(l.params.name),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024),R("span",{class:lt(["sms-text",{warn:m(T.value[a-1])>70}])},B(m(T.value[a-1]))+" 個字 ",3)])]))),256))])]),_:1},8,["modelValue"])])):pe("",!0)}}}),Wt={key:0,class:"ta-group-list-modal"},Kt={class:"summary"},Oe=100,tt=ye({__name:"TaGroupListModal",props:{twmIdList:{}},setup(ie){const u=we(),f=ie,p=U(!1),L=U(1),I=()=>{p.value=!0},T=ve(()=>{const _=(L.value-1)*Oe,v=f.twmIdList.slice(_,_+Oe),y=[];return v.forEach(k=>{const M=u.twmIdUserMap.get(k);M&&y.push(M)}),y}),N=_=>Oe*(L.value-1)+_+1,d=ve(()=>{const _=[];return f.twmIdList.forEach(v=>{const y=u.twmIdUserMap.get(v);y&&_.push(y)}),_}),S=ve(()=>d.value.filter(_=>!!_.phoneNumber).length),m=ve(()=>d.value.filter(_=>!!_.couponCode).length);return(_,v)=>{const y=ee,k=Ue,M=Pe,P=Ve,q=je,ne=He,de=qe,O=ft,E=De;return f.twmIdList?(F(),H("div",Wt,[s(y,{variant:"link",onClick:I},{default:i(()=>[C(B(f.twmIdList.length),1)]),_:1}),s(E,{modelValue:p.value,"onUpdate:modelValue":v[1]||(v[1]=a=>p.value=a),scrollable:"",size:"lg",title:`${f.twmIdList.length}`,class:"ta-list-modal"},{default:i(()=>[R("div",Kt,[C(" 總數："),R("span",null,B(f.twmIdList.length)+"，有門號："+B(S.value)+"("+B(S.value-f.twmIdList.length)+")，有優惠券："+B(m.value)+"("+B(m.value-f.twmIdList.length)+")",1)]),s(de,{hover:"",small:"",bordered:""},{default:i(()=>[s(P,null,{default:i(()=>[s(M,null,{default:i(()=>[s(k,{class:"text-center align-middle"},{default:i(()=>[C("No")]),_:1}),s(k,{class:"text-center align-middle"},{default:i(()=>[C("台灣大會員編號")]),_:1}),s(k,{class:"text-center align-middle"},{default:i(()=>[C("SubId")]),_:1}),s(k,{class:"text-center align-middle"},{default:i(()=>[C("門號")]),_:1}),s(k,{class:"text-center align-middle"},{default:i(()=>[C("資費")]),_:1}),s(k,{class:"text-center align-middle"},{default:i(()=>[C("優惠券序號")]),_:1})]),_:1})]),_:1}),s(ne,null,{default:i(()=>[(F(!0),H(Re,null,Be(T.value,(a,l)=>(F(),me(M,{key:a.twmId},{default:i(()=>[s(q,{class:"text-center align-middle"},{default:i(()=>[C(B(N(l)),1)]),_:2},1024),s(q,{class:"text-center align-middle"},{default:i(()=>[C(B(a.twmId),1)]),_:2},1024),s(q,{class:"text-center align-middle"},{default:i(()=>[C(B(a.subId),1)]),_:2},1024),s(q,{class:"text-center align-middle"},{default:i(()=>[C(B(a.phoneNumber),1)]),_:2},1024),s(q,{class:"text-center align-middle"},{default:i(()=>[C(B(a.params["目前方案專案V+D+V資費"]),1)]),_:2},1024),s(q,{class:"text-center align-middle"},{default:i(()=>[C(B(a.couponCode),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(O,{modelValue:L.value,"onUpdate:modelValue":v[0]||(v[0]=a=>L.value=a),size:"sm","total-rows":f.twmIdList.length,"per-page":Oe},null,8,["modelValue","total-rows"])]),_:1},8,["modelValue","title"])])):pe("",!0)}}}),Qt={class:"calc-button"},Zt=ye({__name:"CalcButton",setup(ie){const u=we(),f=()=>{u.refresh()};return(p,L)=>{const I=ee;return F(),H("div",Qt,[ue(u).needReCalc?(F(),me(I,{key:0,variant:"outline-success",size:"sm",onClick:f},{default:i(()=>[C("重新計算")]),_:1})):ht(p.$slots,"default",{key:1})])}}}),Jt={class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Yt=R("path",{fill:"currentColor",d:"m14 12l-4-4v3H2v2h8v3m10 2V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v3h2V6h12v12H6v-3H4v3a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2Z"},null,-1),Xt=[Yt];function es(ie,u){return F(),H("svg",Jt,[...Xt])}const ts={name:"mdi-import",render:es},ss={class:"import-sms-file"},ns=R("span",null,"TwmId (MFO)",-1),os=ye({__name:"ImportTwmIdFile",setup(ie){const u=we(),f=U([]),p=U(0),L=U(new Set);Ne(f,()=>{!f||f.value.length===0||(p.value=0,L.value.clear(),u.smsGroupList.forEach(N=>{N.smsTwmIdList.length=0}),f.value.forEach(N=>I(N)))}),Ne(p,()=>{p.value===f.value.length&&(u.smsGroupList.forEach(N=>{let d=0,S=0;N.twmIdList.forEach(m=>{L.value.has(m)?(N.smsTwmIdList.push(m),d++):S++}),console.log(`[ImportSmsFile] Group: ${N.name}, Exist: ${d}, NotExist: ${S}`)}),u.refreshFilted())});const I=N=>{const d=new FileReader;d.onload=function(S){var v;const m=(v=S.target)==null?void 0:v.result;(m==null?void 0:m.split(`\r
`)).forEach(y=>{L.value.add(y)}),console.log(`[ImportSmsFile] import ${L.value.size} TwmId`),p.value++},d.readAsText(N)},T=()=>{var N;(N=document.getElementById("import-twmid"))==null||N.click()};return(N,d)=>{const S=ts,m=ee,_=Ze;return F(),H("div",ss,[s(m,{variant:"outline-primary",size:"sm",onClick:T},{default:i(()=>[s(S),ns]),_:1}),s(_,{ref:"configFileRef",id:"import-twmid",modelValue:f.value,"onUpdate:modelValue":d[0]||(d[0]=v=>f.value=v),accept:"text/csv",multiple:""},null,8,["modelValue"])])}}}),is={class:"d-flex flex-column justify-content-end"},as=R("br",null,null,-1),rs=R("br",null,null,-1),ls=R("span",{class:"hint"},"(商務簡訊)",-1),us={class:"text-nowrap"},cs={key:1},ds={class:"text-nowrap"},ms={class:"d-flex flex-column"},ps=R("span",null,"SubId (DSC)",-1),fs=R("span",null,"TwmId (MFO)",-1),hs={class:"d-flex flex-column"},_s=R("span",null,"SubId (DSC)",-1),gs=R("span",null,"TwmId (MFO)",-1),vs=R("span",null,"TwmId (MFO)",-1),bs=R("span",null,"名單總表",-1),Gs=ye({__name:"SmsGroupList",setup(ie){const u=we(),f=U(!0),p=U(0),L=()=>{if(!u.smsGroupList)return f.value=!1,0;console.time("[SmsGroupList] TotalSubIdCount");const a=new Set;for(let l=0;l<u.smsGroupList.length;l++){const t=u.smsGroupList[l].twmIdList;for(let n=0;n<t.length;n++){const r=t[n];a.add(r)}}console.timeEnd("[SmsGroupList] TotalSubIdCount"),f.value=!1,p.value=a.size},I=ve(()=>{let a=0;return u.smsGroupList.forEach(l=>a+=l.smsTwmIdListFilted.length),a}),T=ve(()=>{let a=0;return u.smsGroupList.forEach(l=>a+=l.smsPhoneNumberFilted.length),a}),N=(a,l)=>{const e=a.smsReadyTwmIdList;if(l>=100)a.smsTwmIdList=e.slice(0);else{const t=new Set;a.smsTwmIdList.forEach(o=>t.add(o));const n=e.length*l/100,r=S(e).slice(0,n);r.forEach(o=>t.add(o)),a.smsTwmIdList=Array.from(t),console.log(`[GroupList] addSmsList: ${n}: ${r.length}`)}u.refreshFilted()},d=a=>{for(let l=0;l<u.smsGroupList.length;l++){const e=u.smsGroupList[l];N(e,a)}},S=a=>{const l=a.slice(0);for(let e=l.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[l[e],l[t]]=[l[t],l[e]]}return l},m=a=>{const l=u.smsGroupList.findIndex(t=>t.name===a.name);l>=0&&u.smsGroupList.splice(l,1);const e=new Je(a.name,a.twmIdList);u.groupList.push(e),u.refreshFilted(),f.value=!0},_=()=>{k(a=>a.twmIdList)},v=()=>{k(a=>a.smsTwmIdListFilted)},y=()=>{if(!u.smsGroupList)return;const a=[],l=new Set;for(let e=0;e<u.smsGroupList.length;e++){const n=u.smsGroupList[e].smsPhoneNumberFilted;for(let r=0;r<n.length;r++){const o=n[r],c=u.phoneNumberUserMap.get(o);if(!c)continue;const b=c.twmId;l.has(b)||(l.add(b),a.push([b]))}u.userInfoListTest.forEach(r=>{const o=r.twmId;l.has(o)||(l.add(o),a.push([o]))})}M(a)},k=a=>{if(!u.smsGroupList)return;const l=[],e=new Set;for(let t=0;t<u.smsGroupList.length;t++){const n=u.smsGroupList[t],r=a(n).slice(0);u.userInfoListTest.forEach(o=>r.push(o.twmId));for(let o=0;o<r.length;o++){const c=r[o];e.has(c)||(e.add(c),l.push([c]))}}M(l)},M=a=>{const l=Ge(new Date,"yyyyMMdd"),e=[],t=u.partition(a,2e4);for(let r=0;r<t.length;r++){const o=t[r],c=`${u.campaignName}_MFO_白名單_${l}_${t.length}-${r+1}_${o.length}.csv`,b=$e.unparse(o);e.push({fileName:c,data:b})}const n=`${u.campaignName}_MFO_白名單_${l}_${t.length}_${a.length}.zip`;u.downloadZip(n,e)},P=()=>{ne(a=>a.twmIdList)},q=()=>{ne(a=>a.smsTwmIdListFilted)},ne=a=>{if(!u.smsGroupList)return;const l=[],e=new Set;for(let n=0;n<u.smsGroupList.length;n++){const r=u.smsGroupList[n],o=a(r);for(let c=0;c<o.length;c++){const b=o[c],G=u.twmIdUserMap.get(b);!G||!G.subId||G.phoneNumber&&G.phoneNumber.length>0||e.has(G.subId)||(e.add(G.subId),l.push({SUBSCR_ID:G.subId}))}}console.log(`[SmsGroupList] export ${l.length} subId`);const t=u.partition(l,2e5);for(let n=0;n<t.length;n++){const r=t[n],o=Ge(new Date,"yyyyMMdd"),c=`${u.campaignName}_DSC_SubId_${o}_${t.length}-${n+1}_${r.length}.csv`,b=$e.unparse(r);u.downloadFile(b,c)}},de=()=>{if(!u.smsGroupList)return;const a=[];for(let n=0;n<u.smsGroupList.length;n++){const r=u.smsGroupList[n],o=r.smsPhoneNumberFilted;for(let c=0;c<o.length;c++){const b=o[c],G=u.phoneNumberUserMap.get(b);G&&a.push({Sms:r.name,TwmId:G.twmId,SubId:G.subId,門號:G.phoneNumber,優惠券:G.couponCode})}}console.log(`[SmsGroupList] export ${a.length} All Sms CSV`);const l=Ge(new Date,"yyyyMMdd"),e=`${u.campaignName}_發送名單資訊_${l}_${a.length}.csv`,t=$e.unparse(a);u.downloadFile(t,e)},O=a=>a.smsReadyTwmIdList.length<=a.smsTwmIdList.length,E=()=>{for(let a=0;a<u.smsGroupList.length;a++){const l=u.smsGroupList[a];if(!O(l))return!1}return!0};return(a,l)=>{const e=Ue,t=os,n=Pe,r=Ve,o=je,c=Zt,b=tt,G=qt,z=He,h=We,V=Mt,w=Gt,le=Ye,Z=qe,g=gt;return F(),H("div",is,[s(Z,{hover:"",small:"",bordered:""},{default:i(()=>[s(r,{"head-variant":"dark"},{default:i(()=>[s(n,null,{default:i(()=>[s(e,{class:"text-center align-middle"},{default:i(()=>[C("刪除")]),_:1}),s(e,{class:"text-center align-middle"},{default:i(()=>[C("分群")]),_:1}),s(e,{class:"text-center align-middle"},{default:i(()=>[C("原數量")]),_:1}),s(e,{class:"text-center align-middle"},{default:i(()=>[C("已發送數")]),_:1}),s(e,{class:"text-center align-middle"},{default:i(()=>[C("可發送數")]),_:1}),s(e,{class:"text-center align-middle"},{default:i(()=>[C("發送")]),_:1}),s(e,{class:"text-center align-middle"},{default:i(()=>[C("欲發送數")]),_:1}),s(e,{class:"text-center align-middle"},{default:i(()=>[C(" 發送數"),as,s(t)]),_:1}),s(e,{class:"text-center align-middle"},{default:i(()=>[C("門號數"),rs,ls]),_:1}),s(e,{class:"text-center align-middle"},{default:i(()=>[C("簡訊內容")]),_:1})]),_:1})]),_:1}),s(z,null,{default:i(()=>[(F(!0),H(Re,null,Be(ue(u).smsGroupList,$=>(F(),me(n,{key:$.name},{default:i(()=>[s(o,{class:"text-center align-middle"},{default:i(()=>[s(ue(ee),{variant:"outline-danger",size:"sm",onClick:K=>m($)},{default:i(()=>[C(" 刪除 ")]),_:2},1032,["onClick"])]),_:2},1024),s(e,{class:"align-middle"},{default:i(()=>[C(B($.name),1)]),_:2},1024),s(o,{class:"text-end align-middle"},{default:i(()=>{var K;return[C(B((K=$.twmIdList)==null?void 0:K.length),1)]}),_:2},1024),s(o,{class:"text-end align-middle"},{default:i(()=>[s(c,null,{default:i(()=>[C(B($.sentCount),1)]),_:2},1024)]),_:2},1024),s(o,{class:"text-end align-middle"},{default:i(()=>[s(c,null,{default:i(()=>[s(b,{"twm-id-list":$.smsReadyTwmIdList},null,8,["twm-id-list"])]),_:2},1024)]),_:2},1024),s(o,{class:"text-center align-middle"},{default:i(()=>[R("div",us,[s(ue(ee),{variant:"outline-primary",size:"sm",onClick:K=>N($,10),disabled:O($)},{default:i(()=>[C("+10%")]),_:2},1032,["onClick","disabled"]),s(ue(ee),{variant:"outline-primary",size:"sm",onClick:K=>N($,100),class:"ms-1",disabled:O($)},{default:i(()=>[C("All")]),_:2},1032,["onClick","disabled"])])]),_:2},1024),s(o,{class:"text-end align-middle"},{default:i(()=>[s(b,{"twm-id-list":$.smsTwmIdList},null,8,["twm-id-list"])]),_:2},1024),s(o,{class:"text-end align-middle"},{default:i(()=>[s(c,null,{default:i(()=>[s(b,{"twm-id-list":$.smsTwmIdListFilted},null,8,["twm-id-list"])]),_:2},1024)]),_:2},1024),s(o,{class:"text-end align-middle"},{default:i(()=>[s(c,null,{default:i(()=>[C(B($.smsPhoneNumberFilted.length),1)]),_:2},1024)]),_:2},1024),s(o,{class:"text-center align-middle"},{default:i(()=>[s(G,{"sms-group":$},null,8,["sms-group"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(le,null,{default:i(()=>[s(n,null,{default:i(()=>[s(o),s(o,null,{default:i(()=>[C("共 "+B(ue(u).smsGroupList.length)+" 群",1)]),_:1}),s(o,{class:"text-end"},{default:i(()=>[f.value?(F(),me(ue(ee),{key:0,variant:"outline-success",size:"sm",onClick:L},{default:i(()=>[C("重新計算")]),_:1})):(F(),H("span",cs,B(p.value),1))]),_:1}),s(o),s(o),s(o,null,{default:i(()=>[R("div",ds,[s(ue(ee),{variant:"outline-primary",size:"sm",onClick:l[0]||(l[0]=$=>d(10)),disabled:E()},{default:i(()=>[C("+10%")]),_:1},8,["disabled"]),s(ue(ee),{variant:"outline-primary",size:"sm",onClick:l[1]||(l[1]=$=>d(100)),class:"ms-1",disabled:E()},{default:i(()=>[C("All")]),_:1},8,["disabled"])])]),_:1}),s(o),s(o,{class:"text-end"},{default:i(()=>[C(B(I.value),1)]),_:1}),s(o,{class:"text-end"},{default:i(()=>[C(B(T.value),1)]),_:1}),s(o)]),_:1}),s(n,null,{default:i(()=>[s(o),s(o),s(o,{class:"text-center"},{default:i(()=>[R("div",ms,[s(ue(ee),{variant:"outline-primary",size:"sm",onClick:P},{default:i(()=>[s(h),ps]),_:1}),s(ue(ee),{variant:"outline-primary",size:"sm",onClick:_,class:"mt-1"},{default:i(()=>[s(h),fs]),_:1})])]),_:1}),s(o),s(o),s(o),s(o),s(o,{class:"text-center"},{default:i(()=>[R("div",hs,[_t((F(),me(ue(ee),{variant:"outline-primary",size:"sm",onClick:q,disabled:I.value<=0},{default:i(()=>[s(h),_s]),_:1},8,["disabled"])),[[g,`匯出 ${I.value-T.value} 筆沒有電話號碼的 SubID (DSC 用)`,void 0,{hover:!0,top:!0}]]),s(ue(ee),{variant:"outline-primary",size:"sm",class:"mt-1",onClick:v,disabled:I.value<=0},{default:i(()=>[s(h),gs]),_:1},8,["disabled"])])]),_:1}),s(o,{class:"text-center align-middle"},{default:i(()=>[s(ue(ee),{variant:"outline-primary",size:"sm",onClick:y,disabled:I.value<=0},{default:i(()=>[s(h),vs]),_:1},8,["disabled"])]),_:1}),s(o,{class:"text-center align-middle"},{default:i(()=>[s(V,{disabled:T.value<=0},null,8,["disabled"]),s(w,{class:"mt-1",disabled:T.value<=0},null,8,["disabled"])]),_:1})]),_:1}),s(n,null,{default:i(()=>[s(o),s(o),s(o),s(o),s(o),s(o),s(o),s(o,{colspan:"2",class:"text-center align-middle"},{default:i(()=>[s(ue(ee),{variant:"outline-primary",size:"sm",class:"mt-1",onClick:de,disabled:I.value<=0},{default:i(()=>[s(h),bs]),_:1},8,["disabled"])]),_:1}),s(o)]),_:1})]),_:1})]),_:1})])}}}),ys={key:1},Rs=ye({__name:"TaGroupList",setup(ie){const u=we(),f=U(!0),p=U(0),L=ve(()=>u.groupList?u.groupList.sort((S,m)=>S.name.localeCompare(m.name)):[]),I=()=>{if(!u.groupList)return f.value=!1,0;console.time("[TaGroupList] TotalSubIdCount");const S=new Set;for(let m=0;m<u.groupList.length;m++){const v=u.groupList[m].twmIdList;for(let y=0;y<v.length;y++){const k=v[y];S.add(k)}}console.timeEnd("[TaGroupList] TotalSubIdCount"),p.value=S.size,f.value=!1},T=S=>{const m=u.groupList.findIndex(v=>v.name===S.name);m>=0&&u.groupList.splice(m,1);const _=new vt(S.name,S.twmIdList);u.smsGroupList.push(_),u.refreshFilted()},N=()=>{[...u.groupList].forEach(m=>T(m))},d=async()=>{const[S]=await window.showOpenFilePicker({multiple:!1,types:[{accept:{"text/csv":[".csv"]}}]}),m=await S.getFile(),_=await m.text();$e.parse(_,{header:!1,skipEmptyLines:!0,complete:v=>{if(v.errors.length>0){alert("Parse Error");return}console.log(`[TaGroupList] add ${v.data.length} Users begin`);const y=[];for(let M=0;M<v.data.length;M++){const P=v.data[M],q=u.phoneNumberUserMap.get(P[2]);q&&y.push(q.twmId)}console.log(`[TaGroupList] add ${v.data.length} Users Complete`);const k=new Je(m.name,y);u.groupList.push(k),console.log(`[TaGroupList] complete ${u.groupList.length} TaGroup`)}})};return(S,m)=>{const _=Ue,v=Pe,y=Ve,k=tt,M=je,P=ee,q=He,ne=Ye,de=qe;return F(),H("div",null,[s(de,{hover:"",small:"",bordered:""},{default:i(()=>[s(y,{"head-variant":"dark"},{default:i(()=>[s(v,null,{default:i(()=>[s(_,{class:"text-center align-middle"},{default:i(()=>[C("分群")]),_:1}),s(_,{class:"text-center align-middle"},{default:i(()=>[C("數量")]),_:1}),s(_,{class:"text-center align-middle"},{default:i(()=>[C("加入發送")]),_:1})]),_:1})]),_:1}),s(q,null,{default:i(()=>[(F(!0),H(Re,null,Be(L.value,O=>(F(),me(v,{key:O.name},{default:i(()=>[s(_,{class:"align-middle"},{default:i(()=>[C(B(O.name),1)]),_:2},1024),s(M,{class:"text-center align-middle"},{default:i(()=>[s(k,{"twm-id-list":O.twmIdList},null,8,["twm-id-list"])]),_:2},1024),s(_,{class:"text-center"},{default:i(()=>[s(P,{variant:"outline-primary",size:"sm",onClick:E=>T(O)},{default:i(()=>[C("加入")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(ne,null,{default:i(()=>[s(v,null,{default:i(()=>[s(M,null,{default:i(()=>[C("共 "+B(L.value.length)+" 群",1)]),_:1}),s(M,{class:"text-center"},{default:i(()=>[f.value?(F(),me(P,{key:0,variant:"outline-success",size:"sm",onClick:I},{default:i(()=>[C("重新計算")]),_:1})):(F(),H("span",ys,B(p.value),1))]),_:1}),s(M,{class:"text-center"},{default:i(()=>[s(P,{variant:"outline-primary",size:"sm",onClick:m[0]||(m[0]=O=>N())},{default:i(()=>[C("加入")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(P,{variant:"outline-primary",size:"sm",onClick:d},{default:i(()=>[C("匯入 91App 受眾")]),_:1})])}}}),ws={class:"sms-file-wrapper"},Cs=R("label",{for:"sms-file"},"已發送簡訊 (多選)",-1),Ss={class:"d-flex mt-2 align-items-center w-100"},xs={key:0,class:"hint"},Bs=ye({__name:"ImportSmsSent",setup(ie){const u=we(),f=U(0),p=U(0),L=U(0);Ne(f,(S,m)=>{S===0&&m>0&&u.refreshFilted()});const I=ve(()=>f.value>0),T=async()=>{const S=await window.showOpenFilePicker({id:"marketing-import-sms-sent",multiple:!0,types:[{accept:{"text/plain":[".txt"]}}]});f.value=S.length,S.forEach(async m=>{const v=await(await m.getFile()).text();N(v)})},N=S=>{const m=S==null?void 0:S.split(`
`),_=u.phoneNumberSentSet.size;L.value+=m.length,m.forEach(y=>{const M=y.split("	")[0];u.phoneNumberSentSet.add(M)});const v=u.phoneNumberSentSet.size;console.log(`[SmsFile] load ${v-_} Sent Phone Numbers, Total: ${u.phoneNumberSentSet.size}`),f.value--,p.value++},d=()=>{p.value=0,L.value=0,u.phoneNumberSentSet.clear(),u.refreshFilted()};return(S,m)=>{const _=ee,v=Ke,y=Ae;return F(),H("div",ws,[Cs,R("div",Ss,[s(_,{variant:"outline-primary",size:"sm",onClick:T},{default:i(()=>[C("匯入")]),_:1}),L.value>0&&!I.value?(F(),me(_,{key:0,variant:"outline-primary",size:"sm",class:"remove ms-1",onClick:d},{default:i(()=>[s(v)]),_:1})):pe("",!0),I.value?(F(),me(y,{key:1,variant:"primary",class:"ms-1"})):pe("",!0)]),p.value>0?(F(),H("small",xs," 已讀取 "+B(p.value)+" 檔案, "+B(L.value)+" 筆記錄, 重複 "+B(L.value-ue(u).phoneNumberSentSet.size)+" 門號 ",1)):pe("",!0)])}}}),Ls={class:"import-dsc-wrapper"},ks=R("label",{for:"dsc-file"},"門號 (DSC 轉出 csv)",-1),Is={class:"d-flex mt-2 align-items-center w-100"},$s={key:0,class:"hint"},Ms=ye({__name:"ImportDSC",setup(ie){const u=we(),f=U(0),p=U(0),L=U(0);Xe(async()=>{}),Ne(f,(m,_)=>{m===0&&_>0&&u.refreshFilted()});const I=ve(()=>f.value>0),T=async()=>{const m=await window.showOpenFilePicker({id:"marketing-import-dsc",multiple:!0,types:[{accept:{"text/csv":[".csv"]}}]});f.value=m.length,m.forEach(async _=>{const y=await(await _.getFile()).arrayBuffer(),k=yt.decode(wt.Buffer.from(y),"big5");N(k)})},N=m=>{$e.parse(m,{header:!0,skipEmptyLines:!0,transformHeader:(_,v)=>(console.log(`Header: ${v}`,_),_==="門號"?"phoneNumber":_==="SUBSCR_ID"?"subId":_),complete:_=>{if(_.errors.length>0){alert("Parse Error"),f.value--,p.value++;return}const v=_.data;d(v),f.value--,p.value++}})},d=m=>{L.value+=m.length,m.forEach(_=>{const v=u.subIdUserMap.get(_.subId);v&&(v.phoneNumber=_.phoneNumber,u.phoneNumberUserMap.set(_.phoneNumber,v))}),console.log(`[PhoneNumberFile] read ${m.length} subid <> phone number`)},S=()=>{p.value=0,L.value=0,u.phoneNumberUserMap.clear(),u.refreshFilted()};return(m,_)=>{const v=ee,y=Ke,k=Ae;return F(),H("div",Ls,[ks,R("div",Is,[s(v,{variant:"outline-primary",size:"sm",onClick:T},{default:i(()=>[C("匯入")]),_:1}),L.value>0&&!I.value?(F(),me(v,{key:0,variant:"outline-primary",size:"sm",class:"remove ms-1",onClick:S},{default:i(()=>[s(y)]),_:1})):pe("",!0),I.value?(F(),me(k,{key:1,variant:"primary",class:"ms-1"})):pe("",!0)]),p.value?(F(),H("small",$s,"已讀取 "+B(p.value)+" 檔案, "+B(L.value)+" 筆記錄",1)):pe("",!0)])}}}),Ts={class:"title-wrapper"},Es=R("label",{for:"compaign-name"},"活動名稱",-1),Os=ye({__name:"CampaignName",setup(ie){const u=we(),f=U("");return Xe(()=>{const p=localStorage.getItem("campaign-name");p&&(f.value=p)}),Ne(f,p=>{localStorage.setItem("campaign-name",p),u.campaignName=p}),(p,L)=>{const I=bt;return F(),H("div",Ts,[Es,s(I,{modelValue:f.value,"onUpdate:modelValue":L[0]||(L[0]=T=>f.value=T),type:"text",id:"compaign-name",class:"ms-2"},null,8,["modelValue"])])}}});export{$e as P,ts as _,Os as a,Ms as b,Bs as c,Rs as d,Gs as e};
