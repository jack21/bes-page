import{o as h,a as f,b as e,d as M,u as L,r as d,n as F,w as y,c as $,v as U,e as _,f as I,t as u,j as g,a2 as E,a5 as O,a6 as R,a7 as j,X as B,k as b}from"./index-7ja3dXjv.js";import{u as V}from"./store_file-vOCTNoUF.js";const N={class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Y=e("path",{fill:"currentColor",d:"M9 12h9.8l-2.5-2.5l1.4-1.4l4.9 4.9l-4.9 4.9l-1.4-1.4l2.5-2.5H9zm12 5.4V20H3V6h18v2.6l2 2V4c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2v-4.6z"},null,-1),P=[Y];function T(D,p){return h(),f("svg",N,[...P])}const W={name:"mdi-application-export",render:T},G={class:"file-dsc-export-dsc"},X=e("h6",null,"打包 DSC 檔案 (*.dsc)",-1),Z={class:"password"},q=e("label",{for:"pw"},"檔案密碼：",-1),A=e("span",null,"匯出",-1),J={key:0,class:"info"},K=e("hr",null,null,-1),Q=M({__name:"FileDSCExportDSC",props:{dscDataMap:{},csvDataMap:{},dataMap:{}},setup(D){const p=D,w=L(),l=d("");F(()=>{const t=localStorage.getItem("file_dsc_export_password");t&&(l.value=t)}),y(l,()=>{localStorage.setItem("file_dsc_export_password",l.value)});const i=async()=>{var z;const t=["門號,SUBSCR_ID,"];for(const[k,H]of p.dataMap)t.push(`"${H}","${k}",`);const o=E.encode(t.join(`
`),"big5"),r=new Blob([o],{type:"text/csv"}),n=((z=w.loginUser)==null?void 0:z.email)||"unknown",m=new O(new R("application/zip"),{password:l.value});await m.add(`${n}.csv`,new j(r));const v=await m.close(),C=URL.createObjectURL(v),S=document.createElement("a");S.href=C,S.download=a.value,S.click(),URL.revokeObjectURL(C)},a=$(()=>`data_${U().format("YYYYMMDD")}_${p.dataMap.size}.dsc`),c=$(()=>l.value&&l.value.length>0&&p.dataMap&&p.dataMap.size>0),s=$(()=>c.value?"primary":"outline-primary");return(t,o)=>{const r=B,n=W,m=b;return h(),f("div",G,[X,e("div",Z,[q,_(r,{type:"password",id:"pw",modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=v=>l.value=v)},null,8,["modelValue"])]),_(m,{variant:s.value,size:"sm",onClick:i,disabled:!c.value},{default:I(()=>[_(n),A]),_:1},8,["variant","disabled"]),t.dataMap.size>0?(h(),f("div",J,[K,e("span",null,"檔案："+u(a.value),1),e("span",null,"總筆數："+u(t.dataMap.size),1),e("span",null,"（已排除重複筆數："+u(t.dscDataMap.size+t.csvDataMap.size-t.dataMap.size)+"）",1)])):g("",!0)])}}}),ee={class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},te=e("path",{fill:"currentColor",d:"M1 12h9.8L8.3 9.5l1.4-1.4l4.9 4.9l-4.9 4.9l-1.4-1.4l2.5-2.5H1zM21 2H3c-1.1 0-2 .9-2 2v6.1h2V6h18v14H3v-4H1v4c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2"},null,-1),se=[te];function ae(D,p){return h(),f("svg",ee,[...se])}const x={name:"mdi-application-import",render:ae},oe={class:"file-dsc-import-csv"},ne=e("h6",null,"DSC 系統匯出檔案 (*.csv)",-1),le=e("span",null,"匯入",-1),ce={key:0,class:"info"},ie=e("hr",null,null,-1),pe=M({__name:"FileDSCImportCSV",emits:["onImport"],setup(D,{emit:p}){const w=V(),l=p,i=d(0),a=d(0),c=d(new Map),s=async()=>{const t=await window.showOpenFilePicker({id:"file-dsc-import-csv",multiple:!0,types:[{accept:{"text/csv":[".csv"]}}]});if(!(!t||t.length===0)){i.value=t.length,a.value=0,c.value.clear();for(const o of t){const r=await o.getFile(),n=w.decodeDSCText(await r.text());a.value+=n.lineCount;for(const[m,v]of n.dataMap)c.value.set(m,v)}l("onImport",c.value)}};return(t,o)=>{const r=x,n=b;return h(),f("div",oe,[ne,_(n,{variant:"outline-primary",size:"sm",onClick:s},{default:I(()=>[_(r),le]),_:1}),i.value>0?(h(),f("div",ce,[ie,e("span",null,"檔案："+u(i.value)+" 個檔案",1),e("span",null,"總筆數："+u(a.value),1),e("span",null,"重複筆數："+u(a.value-c.value.size),1),e("span",null,"不重複筆數："+u(c.value.size),1)])):g("",!0)])}}}),re={class:"file-dsc-import-dsc"},de=e("h6",null,"已打包 DSC 檔案 (*.dsc)",-1),ue={class:"password"},_e=e("label",{for:"pw"},"檔案密碼：",-1),me=e("span",null,"匯入",-1),ve={key:0,class:"info"},he=e("hr",null,null,-1),fe=M({__name:"FileDSCImportDSC",emits:["onImport"],setup(D,{emit:p}){const w=p,l=V(),i=d("");F(()=>{const o=localStorage.getItem("file_dsc_import_password");o&&(i.value=o)}),y(i,()=>{localStorage.setItem("file_dsc_import_password",i.value)});const a=d(null),c=d(0),s=d(new Map),t=async()=>{const o=await window.showOpenFilePicker({id:"file-dsc-import-dsc",multiple:!1,types:[{accept:{"application/dsc":[".dsc"]}}]});if(!o||o.length===0)return;c.value=0,s.value.clear(),a.value=o[0];const r=await a.value.getFile();try{const n=await l.decodeDSCFile(r,i.value);c.value=n.lineCount;for(const[m,v]of n.dataMap)s.value.set(m,v);w("onImport",s.value)}catch(n){alert(`解開 DSC 檔案發生錯誤: ${n}`)}};return(o,r)=>{const n=B,m=x,v=b;return h(),f("div",re,[de,e("div",ue,[_e,_(n,{type:"password",id:"pw",modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=C=>i.value=C)},null,8,["modelValue"])]),_(v,{variant:"outline-primary",size:"sm",onClick:t,disabled:!i.value},{default:I(()=>[_(m),me]),_:1},8,["disabled"]),a.value?(h(),f("div",ve,[he,e("span",null,"檔案："+u(a.value.name),1),e("span",null,"筆數："+u(c.value),1),e("span",null,"重複筆數："+u(c.value-s.value.size),1),e("span",null,"不重複筆數："+u(s.value.size),1)])):g("",!0)])}}}),we={class:"file-dsc"},De=e("span",null,"DSC 檔案打包",-1),Ce={class:"main"},Me=e("div",{class:"split"},"+",-1),Se=e("div",{class:"split"},"=",-1),ge=M({__name:"FileDSC",setup(D){const p=d(new Map),w=s=>{p.value=s,c()},l=d(new Map),i=s=>{l.value=s,c()},a=d(new Map),c=()=>{a.value.clear();for(const[s,t]of p.value)a.value.set(s,t);for(const[s,t]of l.value)a.value.set(s,t)};return(s,t)=>{const o=fe,r=pe,n=Q;return h(),f("div",we,[De,e("div",Ce,[_(o,{class:"zone",onOnImport:w}),Me,_(r,{class:"zone",onOnImport:i}),Se,_(n,{class:"zone",dscDataMap:p.value,csvDataMap:l.value,dataMap:a.value},null,8,["dscDataMap","csvDataMap","dataMap"])])])}}});export{ge as default};
